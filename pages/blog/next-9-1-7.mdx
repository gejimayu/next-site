import withPost from '../../components/blog/with-post'
import Image from '../../components/image'
import { meta } from '../../blog/next-9-1-7-preview.mdx'
import { TerminalInput } from '../../components/text/terminal'
import Head from 'next/head'

export const config = { amp: true }

export default withPost({ ...meta })

<Head>
  <script
    async
    custom-element="amp-twitter"
    src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"
  />
</Head>

[Next.js 9](/blog/next-9) was released six (6) months ago, followed by [Next.js 9.1](/blog/next-9-1) three (3) months ago.
These two releases added very powerful new features to Next.js, without increasing our baseline client runtime size.

Since then, we've focused heavily on refining and improving the framework as a whole:
[9.1.1](https://github.com/zeit/next.js/releases/tag/v9.1.1),
[9.1.2](https://github.com/zeit/next.js/releases/tag/v9.1.2),
[9.1.3](https://github.com/zeit/next.js/releases/tag/v9.1.3),
[9.1.4](https://github.com/zeit/next.js/releases/tag/v9.1.4),
[9.1.5](https://github.com/zeit/next.js/releases/tag/v9.1.5),
[9.1.6](https://github.com/zeit/next.js/releases/tag/v9.1.6),
and [9.1.7](https://github.com/zeit/next.js/releases/tag/v9.1.7).
Let's dive into what these releases have improved!

- **[3% – 8%+ Smaller Client-Side JavaScript Size](#3--8-smaller-client-side-javascript-size)**: We've optimized application output even futher, shaving 7.5kB off hello world applications. More complex applications will show a savings up to 8% or more.
- **[Redesigned Production Build CLI Output](#redesigned-production-build-cli-output)**: The production build output now shows gzipped file sizes in an easier to understand format.
- **[New Built-In Polyfills: Fetch API, `URL`, and `Object.assign`](#new-built-in-polyfills-fetch-api-url-and-objectassign)**: Applications can leverage the Fetch API, `URL`, and `Object.assign` in legacy browsers without compatibility concerns.
- **[Optimized Page Loading: Better FCP and TTI](#optimized-page-loading-better-fcp-and-tti)**: We've collaborated closely with the Google Chrome team to maximize page loading performance. This results in a much better end-user experience.
- **[Support for the Latest JavaScript Features](#support-for-the-latest-javascript-features)**: We're committed to ensuring you can always use the latest JavaScript features, including [Optional Chaining](https://github.com/tc39/proposal-optional-chaining), [Nullish Coalescing](https://github.com/tc39/proposal-nullish-coalescing), and all other ES2020 (ES11) features.
- **[Zero-Config Deployment Support for `next export` Applications](#zero-config-deployment-support-for-next-export-applications)**: `next export` powered applications can now be deployed to [ZEIT Now](https://zeit.co/home) with zero configuration.
- **[React Strict Mode Compliance and Opt-In](#react-strict-mode-compliance-and-opt-in)**: All of Next.js' client-side runtime is now compatible with React's Strict Mode. We've also added a configuration option to enable this mode for your whole application.
- **[Automated Testing against Nightly React Builds](#automated-testing-against-nightly-react-builds)**: Next.js is automatically tested against [React's next channel](https://reactjs.org/blog/2019/10/22/react-release-channels.html), ensuring compatibility with future releases.

All of these benefits are non-breaking and fully backwards compatible. All you need to do to update is run:

<TerminalInput
  prefix
>{`npm i next@latest react@latest react-dom@latest`}</TerminalInput>

### 3% – 8%+ Smaller Client-Side JavaScript Size

In collaboration with the Google Chrome team, all Next.js applications will
benefit from a **7.5kB or more** size reduction.

Basic applications should see a 3-4% application size reduction, and more
advanced applications may see upwards of 6-8% (or more)!

<table>
  <thead>
    <tr>
      <th>&nbsp;</th>
      <th>9.0.x</th>
      <th>
        <b>9.1.x</b>
      </th>
      <th>diff</th>
      <th>delta</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Basic Application</td>
      <td>
        <b>241kB</b>
      </td>
      <td>
        <b>233kB</b>
      </td>
      <td>
        <b>8kB</b>
        <em>smaller</em>
      </td>
      <td>
        <b>3.38%</b>
        <em>smaller</em>
      </td>
    </tr>
    <tr>
      <td>
        <a target="_blank" href="https://zeit.co/home">
          ZEIT.co
        </a>{' '}
        Application
      </td>
      <td>
        <b>13.2MB</b>
      </td>
      <td>
        <b>12.4MB</b>
      </td>
      <td>
        <b>0.8MB</b>
        <em>smaller</em>
      </td>
      <td>
        <b>6.25%</b>
        <em>smaller</em>
      </td>
    </tr>
  </tbody>
</table>

These savings are partially attributable to
[replacing the `url` package's client-side version](https://github.com/GoogleChromeLabs/native-url)
with one built atop the [URL API](https://developer.mozilla.org/en-US/docs/Web/API/URL).

More size reduction has been accomplished by providing built-in, small
polyfills for often-used packages. You can
[read more about those polyfills here](#new-built-in-polyfills-fetch-api-url-and-objectassign).

Lastly, we've optimized our JSX output which will introduce savings in direct
correlation to the amount of JSX in your application.

### Redesigned Production Build CLI Output

TODO: Redesigned Production Build CLI Output

### New Built-In Polyfills: Fetch API, `URL`, and `Object.assign`

TODO: New Built-In Polyfills: Fetch API, `URL`, and `Object.assign`

### Optimized Page Loading: Better FCP and TTI

TODO: Optimized Page Loading: Better FCP and TTI

### Support for the Latest JavaScript Features

Next.js has an advanced, highly optimized compilation pipeline that allows you to use the latest JavaScript features.
Recent optimizations we have introduced directly contributed to the
[3-8% reduction](#3--8-smaller-client-side-javascript-size) in application size.

These JavaScript features can be leveraged without worrying about browser compatibility, as we automatically compile
your code to support all browsers (excluding end-of-life versions).
This includes ES6+ features, such as
[async/await (ES2017)](https://github.com/tc39/ecmascript-asyncawait),
[Object Rest/Spread Properties (ES2018)](https://github.com/tc39/proposal-object-rest-spread),
[Dynamic `import()` (ES2020)](https://v8.dev/features/dynamic-import),
and more!

In this release, we're happy to announce support for
[Optional Chaining (Stage 4)](https://github.com/tc39/proposal-optional-chaining)
and [Nullish Coalescing (Stage 4)](https://github.com/tc39/proposal-nullish-coalescing).

```jsx
function Page() {
  const truck = { brand: { tesla: { name: 'Cybertruck' } } }
  return (
    <>
      <p>Truck of the year is: {truck.brand?.tesla?.name ?? 'Ford F-150'}</p>
      {/* ⬆ Cybertruck */}
      <p>Runner up is: {truck.brand?.competition?.name ?? 'Ford F-150'}</p>
      {/* ⬆ Ford F-150 */}
    </>
  )
}

export default Page
```

In the future, we plan to output even more optimized bundles via automatic
[module / nomodule builds](https://nextjs.org/blog/next-9-1#module--nomodule).

### Zero-Config Deployment Support for `next export` Applications

Next.js now works with [ZEIT Now's Zero Configuration](https://zeit.co/zero-config) out-of-the-box.
Prior to this change, users who leveraged `next export` were required to create a custom `now.json`.

Leveraging Next.js' export-mode on [ZEIT Now](https://zeit.co/home) is now as simple as having the following `build` script in `package.json`:

```js
{
  "scripts": {
    "build": "next build && next export"
  }
}
```

Then, you can deploy your Next.js application to [ZEIT Now](https://zeit.co/home) with **only a single command**.<br/>
If you have not yet installed Now, you can do so by [installing Now CLI](https://zeit.co/download).

<TerminalInput prefix>{`now`}</TerminalInput>

### React Strict Mode Compliance and Opt-In

All of Next.js' runtime is now Strict Mode-compliant.
This included updates to Next.js' head manager (`<Head>`), `next/dynamic`, and other core features.
This means the runtimes now leverage hooks or have eliminated deprecated lifecycles,
and are using React's new Context API.

We've also added a convenient opt-in option for you to enable Strict Mode for
your application.

To do so, configure the following option in your `next.config.js`:

```js
// next.config.js
module.exports = {
  reactStrictMode: true
}
```

If you or your team are not ready to use Strict Mode in your entire application,
that's OK!
You can incrementally migrate on a page-by-page basis
[using `<React.StrictMode>`](https://reactjs.org/docs/strict-mode.html).

While **not required**, Strict Mode will unlock a myriad optimizations in the future.
Because of this, we suggest you look into it sooner rather than later!

### Automated Testing against Nightly React Builds

In [close collaboration](https://github.com/zeit/next.js/pull/9165) with the React Core Team, we're now
[testing](https://github.com/zeit/next.js/pull/9151) Next.js against React's next channel every 12 hours.

These tests help ensure we're prepared and compatible with the future releases of React.
Compatibility is something Next.js takes very seriously, and we're committed to the long-term
API stability of Next.js.

This process [has been documented](https://reactjs.org/blog/2019/10/22/react-release-channels.html)
by the React Core Team in hopes other partners in the React ecosystem follow suit.

## Community

We are excited about the upcoming changes that will improve size and performance across all Next.js applications.

Furthermore, the Next.js community is still expanding:

- We have had over **865** independent contributors.
- On GitHub, the project has been starred over **43,700** times.
- The [examples directory](https://github.com/zeit/next.js/tree/canary/examples) has over **220 examples.**

The Next.js community on [spectrum.chat/next-js](https://spectrum.chat/next-js) now has over **13,600** members. [Join us](https://spectrum.chat/next-js)!

We are thankful to our community and all the external feedback and contributions that helped shape this release.

<style jsx>{`
  :global(.twitter-tweet) {
    margin: 0 auto;
  }
  table {
    margin: 0 auto 30px;
  }
  table td,
  table th {
    padding: 10px 20px;
  }
  table th {
    font-weight: normal;
    font-size: 12px;
    color: #9b9b9b;
    padding-bottom: 0px;
  }
  table td:first-child {
    width: 55%;
  }
  table td {
    font-size: 14px;
    vertical-align: middle;
  }
  table td:nth-last-child(2) {
    color: #067df7;
  }
  table td:last-child {
    color: #067df7;
  }
  table td:not(:first-child) {
    text-align: center;
  }
  table td em {
    font-weight: normal;
    font-size: 10px;
    text-transform: uppercase;
    font-style: normal;
    display: block;
  }
  // CSS only media query for mobile
  @media screen and (max-width: 640px) {
    table td,
    table th {
      padding: 10px 10px;
    }
  }
`}</style>
